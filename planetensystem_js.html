<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Seite der Astronnomie AG am Leverkusener Wener-Heisenberg-Gymnasium">
    <meta name="author" content="AstronomieAG">
    <link rel="icon" href="images/cropped-supermoon-n-14-11-2016-g11.png">
    <title>Das Planetensystem</title>
</head>

<body>
    <h1 style="color: white">Das Planetensystem</h1>

    <script src="js/three.min.js"></script>
    <script src="js/chromeFixes.js"></script>
    <canvas id="c"></canvas>
    <script>
        var scene = new THREE.Scene();

        var canvas = document.querySelector('#c');
        var aspect_ratio = window.innerWidth / window.innerHeight;
        var above_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 0.01, 1e6)
        above_cam.position.z = 25000;
        scene.add(above_cam);

        var earth_mars_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6);
        scene.add(earth_mars_cam);

        var earth_moon_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6);
        scene.add(earth_moon_cam);

        var camera = above_cam;
        var renderer = new THREE.WebGLRenderer({
            canvas
        });
        renderer.setSize(window.innerWidth - 50, window.innerHeight - 50);
        document.body.appendChild(renderer.domElement);

        document.body.style.backgroundColor = 'black';

        //in AE * 1000 bzw e3
        //Sonne
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0xFFD700
        });
        var star = new THREE.SphereGeometry(150, 20, 20);
        var sun = new THREE.Mesh(star, surface);
        scene.add(sun);

        var ambient = new THREE.AmbientLight(0xffffff);
        scene.add(ambient);

        var sunlight = new THREE.PointLight(0xffffff, 5, 0);
        scene.add(sunlight);

        //Merkur
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x555555
        });
        var planet = new THREE.SphereGeometry(60, 20, 20);
        var merkur = new THREE.Mesh(planet, surface);
        merkur.position.set(387, 0, 0);
        scene.add(merkur);

        //Venus
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xffff44
        });
        var planet = new THREE.SphereGeometry(60, 20, 20);
        var venus = new THREE.Mesh(planet, surface);
        venus.position.set(723, 0, 0);
        scene.add(venus);

        //Erde
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x0000cd
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var earth = new THREE.Mesh(planet, surface);
        earth.position.set(1e3, 0, 0);
        scene.add(earth);

        //Mond
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xffffff
        });
        var planet = new THREE.SphereGeometry(50, 30, 25);
        var moon = new THREE.Mesh(planet, surface);
        earth.add(earth_moon_cam);
        earth.add(earth_mars_cam)
        earth_moon_cam.rotation.set(Math.PI / 2, 0, 0);
        scene.add(moon);

        //Mars
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb22222
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var mars = new THREE.Mesh(planet, surface);
        mars.position.set(1.524e3, 0, 0);
        scene.add(mars);

        //Jupiter
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb28222
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var jupiter = new THREE.Mesh(planet, surface);
        jupiter.position.set(5.203e3, 0, 0);
        scene.add(jupiter);

        //Saturn
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb24222
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var saturn = new THREE.Mesh(planet, surface);
        saturn.position.set(9.5826e3, 0, 0);
        scene.add(saturn);

        //Uranus
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x7777aa
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var uranus = new THREE.Mesh(planet, surface);
        uranus.position.set(19.201e3, 0, 0);
        scene.add(uranus);

        //Neptun
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x2222aa
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var neptun = new THREE.Mesh(planet, surface);
        neptun.position.set(30.070e3, 0, 0);
        scene.add(neptun);

        //Pluto
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xd2b48c
        });
        var planet = new THREE.SphereGeometry(60, 20, 15);
        var pluto = new THREE.Mesh(planet, surface);
        pluto.position.set(39.482e3, 0, 0);
        scene.add(pluto);

        var time = Math.floor(Math.random() * 100000),
            speed = 1,
            pause = false;

        function pos_planet(T, e, a, tag) {
            M = 2 * Math.PI / T * tag;
            E = M
            for (i = 0; i < 5; i++) E -= ((M - E + e * Math.sin(E)) / (e * Math.cos(E) - 1));
            r = a * (1 - e * Math.cos(E));
            v = 2 * Math.atan(Math.sqrt((1 + e) / (1 - e)) * Math.tan(E));
            return [r * Math.cos(v), r * Math.sin(v)];
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);

            if (pause) return;
            time += speed;

            var me_pos = pos_planet(87.969, 0.205634, 387.099, time / 100);
            merkur.position.set(me_pos[0], me_pos[1], 0);

            var v_pos = pos_planet(224.701, 0.00677, 723, time / 100);
            venus.position.set(v_pos[0], v_pos[1], 0);

            var e_pos = pos_planet(365.256, 0.0167, 1e3, time / 100);
            earth.position.set(e_pos[0], e_pos[1], 0);

            var mo_pos = pos_planet(27.3217, 0.0549, 70, time / 100); // Abstand zu Erde nicht Maßstabsgetreu
            moon.position.set(mo_pos[0] + e_pos[0], mo_pos[1] + e_pos[1], 0);

            var ma_pos = pos_planet(686.980, 0.0935, 1.524e3, time / 100);
            mars.position.set(ma_pos[0], ma_pos[1], 0);

            var j_pos = pos_planet(4330, 0.0484, 5.203e3, time / 100);
            jupiter.position.set(j_pos[0], j_pos[1], 0);

            var s_pos = pos_planet(10751.805, 0.05648, 9.5826e3, time / 100);
            saturn.position.set(s_pos[0], s_pos[1], 0);

            var u_pos = pos_planet(30664.015, 0.0472, 19.201e3, time / 100);
            uranus.position.set(u_pos[0], u_pos[1], 0);

            var n_pos = pos_planet(60148.35, 0.00859, 30.070e3, time / 100);
            neptun.position.set(n_pos[0], n_pos[1], 0);

            var p_pos = pos_planet(90498, 0.2488, 39.482e3, time / 100);
            pluto.position.set(p_pos[0], p_pos[1], 0);

            var y_diff = mars.position.y - earth.position.y;
            var x_diff = mars.position.x - earth.position.x;
            var angle = Math.atan2(x_diff, y_diff);

            earth_mars_cam.rotation.set(Math.PI / 2, -angle, 0);

            var y_diff = moon.position.y - earth.position.y;
            var x_diff = moon.position.x - earth.position.x;
            var angle = Math.atan2(x_diff, y_diff);

            earth_moon_cam.rotation.set(Math.PI / 2, -angle, 0);
        }

        animate();

        //        var stars = new THREE.Geometry();
        //        while (stars.vertices.length < 1e4) {
        //            var lat = Math.PI * Math.random() - Math.PI / 2;
        //            var lon = 2 * Math.PI * Math.random();
        //
        //            stars.vertices.push(new THREE.Vector3(
        //                1e5 * Math.cos(lon) * Math.cos(lat),
        //                1e5 * Math.sin(lon) * Math.cos(lat),
        //                1e5 * Math.sin(lat)
        //            ));
        //        }
        //        var star_stuff = new THREE.ParticleBasicMaterial({
        //            size: 500
        //        });
        //        var star_system = new THREE.ParticleSystem(stars, star_stuff);
        //        scene.add(star_system);

        document.addEventListener("keydown", function(event) {
            var code = event.keyCode;
            switch (code) {
                case 67: //c
                    changeCamera();
                    break;
                case 80: //P
                    pause = !pause;
                    break;
                case 107: //+
                    speed++;
                    break;
                case 109: //-
                    if (speed > 1) speed--;
                    break;
            }
        });

        function changeCamera() {
            if (camera == above_cam) camera = earth_mars_cam;
            else if (camera == earth_mars_cam) camera = earth_moon_cam;
            else camera = above_cam;
        }
    </script>

    <h3 style="color: white; margin-bottom: 0px;">Steuerung:</h3> <br />
    <h5 style="color: white; margin-top: 0px;">
        C = Kamera wechseln<br />
        P = Pause<br />
        + = schneller<br />
        - = langsamer <br />
        Die Planeten haben noch nicht die richtigen Größen aber die Abstände (außer bei Mond) und Umlaufbahnen stimmen.
    </h5>
    <a href="https://whg-astro-ag.com/das-planetensystem/das-planetensystem-in-digital/">zurück zur Website</a>
</body></html>
