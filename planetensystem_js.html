<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Seite der Astronnomie AG am Leverkusener Wener-Heisenberg-Gymnasium">
    <meta name="author" content="AstronomieAG">
    <link rel="icon" href="images/cropped-supermoon-n-14-11-2016-g11.png">
    <title>Das Planetensystem</title>
    <style>
        ::-webkit-scrollbar {
            display: block;

        }

    </style>
</head>

<body>
    <h1 style="color: white">Das Planetensystem</h1>
    <h5 style="color: white">für mehr Informationen scrollen. Vollbildmodus (F11) wird empfohlen.</h5>

    <script src="js/three.min.js"></script>
    <script src="js/chromeFixes.js"></script>
    <canvas style="z-index: -9; width: 97vw; height: 97vw" id="c">Your browser does not support the HTML 5 Canvas. </canvas>
    <canvas style="position: absolute; z-index: 5; width: 97vw; height: 97vw" id="ct"></canvas>
    <script>
        var c = document.getElementById("ct");
        c.height = window.innerWidth * 0.97;
        c.width = window.innerWidth * 0.97;
        var ctx = c.getContext("2d");
        ctx.fillStyle = "white";
        ctx.font = "15px Verdana";
        var update = true;

        function disable_update() {
            update = false;
            clear();
        }

        function enable_update() {
            update = true;
        }

        function clear() {
            ctx.clearRect(0, 0, c.width, c.height);
        }

        function updateText(polar, name) {
            if (update) {
                ctx.fillText(name, (polar[0] * Math.cos(-polar[1])) + window.innerWidth * 0.97 * 0.5,
                    (polar[0] * Math.sin(-polar[1])) + window.innerWidth * 0.97 * 0.5);
            }
        }

        function updateTextMoon(polarMoon, polarPlanet, name) {
            if (update) {
                ctx.fillText(name,
                    (polarMoon[0] * Math.cos(-polarMoon[1])) + (polarPlanet[0] * Math.cos(-polarPlanet[1])) + window.innerWidth * 0.97 * 0.5,
                    (polarMoon[0] * Math.sin(-polarMoon[1])) + (polarPlanet[0] * Math.sin(-polarPlanet[1])) + window.innerWidth * 0.97 * 0.5);
            }
        }

    </script>
    <script>
        var scene = new THREE.Scene();

        var canvas = document.querySelector('#c');
        var aspect_ratio = 1;
        var above_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 0.01, 1e6)
        above_cam.position.z = 50000;
        scene.add(above_cam);

        var earth_mars_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6);
        scene.add(earth_mars_cam);

        var earth_moon_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6);
        scene.add(earth_moon_cam);

        var camera = above_cam;
        var renderer = new THREE.WebGLRenderer({
            canvas
        });
        renderer.setSize(window.innerWidth * 0.97, window.innerWidth * 0.97);
        document.body.appendChild(renderer.domElement);

        document.body.style.backgroundColor = 'black';

        //in AE * 1000 bzw e3
        geo_resolution = 30;
        moon_orbit_add = 0;
        focus = 0;

        //Sonne
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0xFFD700
        });
        var star = new THREE.SphereGeometry(4.6547587, geo_resolution, geo_resolution);
        var sun = new THREE.Mesh(star, surface);
        scene.add(sun);

        var ambient = new THREE.AmbientLight(0xffffff);
        scene.add(ambient);

        var sunlight = new THREE.PointLight(0xffffff, 5, 0);
        scene.add(sunlight);

        //Merkur
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x555555
        });
        var planet = new THREE.SphereGeometry(3.2616774e-2 / 2, geo_resolution, geo_resolution);
        var merkur = new THREE.Mesh(planet, surface);
        merkur.position.set(387, 0, 0);
        scene.add(merkur);

        //Venus
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xffff44
        });
        var planet = new THREE.SphereGeometry(0.0404537843, geo_resolution, geo_resolution);
        var venus = new THREE.Mesh(planet, surface);
        venus.position.set(723, 0, 0);
        scene.add(venus);

        //Erde
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x0000cd
        });
        var planet = new THREE.SphereGeometry(0.0852707324 / 2, geo_resolution, geo_resolution);
        var earth = new THREE.Mesh(planet, surface);
        earth.position.set(1e3, 0, 0);
        scene.add(earth);

        //Mond
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xffffff
        });
        var planet = new THREE.SphereGeometry(0.02323562484 / 2, geo_resolution, geo_resolution);
        var moon = new THREE.Mesh(planet, surface);
        scene.add(moon);

        //Mars
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb22222
        });
        var planet = new THREE.SphereGeometry(0.04540438957 / 2, geo_resolution, geo_resolution);
        var mars = new THREE.Mesh(planet, surface);
        mars.position.set(1.524e3, 0, 0);
        scene.add(mars);

        //Jupiter
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb28222
        });
        var planet = new THREE.SphereGeometry(0.95578900509 / 2, geo_resolution, geo_resolution);
        var jupiter = new THREE.Mesh(planet, surface);
        jupiter.position.set(5.203e3, 0, 0);
        scene.add(jupiter);

        //Saturn
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb24222
        });
        var planet = new THREE.SphereGeometry(0.80573339337 / 2, geo_resolution, geo_resolution);
        var saturn = new THREE.Mesh(planet, surface);
        saturn.position.set(9.5826e3, 0, 0);
        scene.add(saturn);

        //Uranus
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x7777aa
        });
        var planet = new THREE.SphereGeometry(0.34170272452 / 2, geo_resolution, geo_resolution);
        var uranus = new THREE.Mesh(planet, surface);
        uranus.position.set(19.201e3, 0, 0);
        scene.add(uranus);

        //Neptun
        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x2222aa
        });
        var planet = new THREE.SphereGeometry(0.33107423099 / 2, geo_resolution, geo_resolution);
        var neptun = new THREE.Mesh(planet, surface);
        neptun.position.set(30.070e3, 0, 0);
        scene.add(neptun);

        var time = Math.floor(Math.random() * 1e8),
            speed = 1,
            pause = false;

        function polar_planet(T, e, a, tag) {
            M = 2 * Math.PI / T * tag;
            E = M
            for (i = 0; i < 5; i++) E -= ((M - E + e * Math.sin(E)) / (e * Math.cos(E) - 1));
            r = a * (1 - e * Math.cos(E));
            v = 2 * Math.atan(Math.sqrt((1 + e) / (1 - e)) * Math.tan(E));
            return [r, v];
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);

            if (pause) return;
            time += speed;

            clear();
            updateText([0, 0], "Sonne");

            var polar = polar_planet(87.969, 0.205634, 387.099, time / 100);
            merkur.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Merkur");

            var polar = polar_planet(224.701, 0.00677, 723, time / 100);
            venus.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Venus");

            var polar = polar_planet(365.256, 0.0167, 1e3, time / 100);
            var polar_e = polar
            earth.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Erde");

            var polar = polar_planet(27.3217, 0.0549, 2.5695552898, time / 100);
            moon.position.set((polar[0] + moon_orbit_add) * Math.cos(polar[1]) + polar_e[0] * Math.cos(polar_e[1]),
                (polar[0] + moon_orbit_add) * Math.sin(polar[1]) + polar_e[0] * Math.sin(polar_e[1]), 0);
            updateTextMoon([(polar[0] + moon_orbit_add) / (above_cam.position.z * 1e-3), polar[1]], [polar_e[0] / (above_cam.position.z * 1e-3), polar_e[1]], "Mond");

            var polar = polar_planet(686.980, 0.0935, 1.524e3, time / 100);
            mars.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Mars");

            var polar = polar_planet(4330, 0.0484, 5.203e3, time / 100);
            jupiter.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Jupiter");

            var polar = polar_planet(10751.805, 0.05648, 9.5826e3, time / 100);
            saturn.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Saturn");

            var polar = polar_planet(30664.015, 0.0472, 19.201e3, time / 100);
            uranus.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Uranus");

            var polar = polar_planet(60148.35, 0.00859, 30.070e3, time / 100);
            neptun.position.set(polar[0] * Math.cos(polar[1]), polar[0] * Math.sin(polar[1]), 0);
            updateText([polar[0] / (above_cam.position.z * 1e-3), polar[1]], "Neptun");

            var y_diff = mars.position.y - earth.position.y;
            var x_diff = mars.position.x - earth.position.x;
            var angle = Math.atan2(x_diff, y_diff);

            earth_mars_cam.rotation.set(Math.PI / 2, -angle, 0);
            earth_mars_cam.position = earth.position;

            var y_diff = moon.position.y - earth.position.y;
            var x_diff = moon.position.x - earth.position.x;
            var angle = Math.atan2(x_diff, y_diff);

            earth_moon_cam.position = earth.position;
            earth_moon_cam.rotation.set(Math.PI / 2, -angle, 0);

            update_above_cam();
        }

        animate();

        var stars = new THREE.Geometry();
        while (stars.vertices.length < 1e4) {
            var lat = Math.PI * Math.random() - Math.PI / 2;
            var lon = 2 * Math.PI * Math.random();

            stars.vertices.push(new THREE.Vector3(
                1e5 * Math.cos(lon) * Math.cos(lat),
                1e5 * Math.sin(lon) * Math.cos(lat),
                1e5 * Math.sin(lat)
            ));
        }
        var star_stuff = new THREE.ParticleBasicMaterial({
            size: 1
        });
        var star_system = new THREE.ParticleSystem(stars, star_stuff);
        scene.add(star_system);

        document.addEventListener("keydown", function(event) {
            var code = event.keyCode;
            switch (code) {
                case 67: //c
                    changeCamera();
                    break;
                case 80: //P
                    pause = !pause;
                    break;
                case 107: //+
                    speed++;
                    document.getElementById("speed").innerHTML = speed;
                    break;
                case 109: //-
                    if (speed > 1) speed--;
                    document.getElementById("speed").innerHTML = speed;
                    break;
                case 87: //w
                    //                    camera.fov -= 10;
                    //                    camera.updateProjectionMatrix();
                    if (above_cam.position.z > 500) above_cam.position.z -= 500;
                    document.getElementById("distance").innerHTML = above_cam.position.z / 1e3;
                    break;
                case 83: //s
                    //                    camera.fov += 10;
                    //                    camera.updateProjectionMatrix();
                    if (above_cam.position.z < 90000) above_cam.position.z += 500;
                    document.getElementById("distance").innerHTML = above_cam.position.z / 1e3;
                    break;
            }
        });

        function changeCamera() {
            if (camera == above_cam) {
                camera = earth_mars_cam;
                disable_update();
            } else if (camera == earth_mars_cam) {
                camera = earth_moon_cam;
                disable_update();
            } else {
                camera = above_cam;
                if (!document.getElementById("check_names").checked) enable_update();
            }
        }

        function scale_sun(val) {
            sun.scale.x = 4.6547587 * 2 + val * 1;
            sun.scale.y = 4.6547587 * 2 + val * 1;
            sun.scale.z = 4.6547587 * 2 + val * 1;
        }

        function scale_orbit_m(val) {
            moon_orbit_add = val * 100;
        }

        function scale(val) {
            merkur.scale.x = 3.2616774e-2 + val * 100;
            merkur.scale.y = 3.2616774e-2 + val * 100;
            merkur.scale.z = 3.2616774e-2 + val * 100;

            venus.scale.x = 0.0404537843 * 2 + val * 100;
            venus.scale.y = 0.0404537843 * 2 + val * 100;
            venus.scale.z = 0.0404537843 * 2 + val * 100;

            earth.scale.x = 0.0852707324 + val * 100;
            earth.scale.y = 0.0852707324 + val * 100;
            earth.scale.z = 0.0852707324 + val * 100;

            moon.scale.x = 0.02323562484 + val * 100;
            moon.scale.y = 0.02323562484 + val * 100;
            moon.scale.z = 0.02323562484 + val * 100;

            mars.scale.x = 0.04540438957 + val * 100;
            mars.scale.y = 0.04540438957 + val * 100;
            mars.scale.z = 0.04540438957 + val * 100;

            jupiter.scale.x = 0.95578900509 + val * 100;
            jupiter.scale.y = 0.95578900509 + val * 100;
            jupiter.scale.z = 0.95578900509 + val * 100;

            saturn.scale.x = 0.80573339337 + val * 100;
            saturn.scale.y = 0.80573339337 + val * 100;
            saturn.scale.z = 0.80573339337 + val * 100;

            uranus.scale.x = 0.34170272452 + val * 100;
            uranus.scale.y = 0.34170272452 + val * 100;
            uranus.scale.z = 0.34170272452 + val * 100;

            neptun.scale.x = 0.33107423099 + val * 100;
            neptun.scale.y = 0.33107423099 + val * 100;
            neptun.scale.z = 0.33107423099 + val * 100;
        }

        function update_above_cam() {
            z = above_cam.position.z;
            switch (focus) {
                case 0:
                    above_cam.position.set(sun.position.x, sun.position.y, z);
                    break;
                case 1:
                    above_cam.position.set(merkur.position.x, merkur.position.y, z);
                    break;
                case 2:
                    above_cam.position.set(venus.position.x, venus.position.y, z);
                    break;
                case 3:
                    above_cam.position.set(earth.position.x, earth.position.y, z);
                    break;
                case 4:
                    above_cam.position.set(moon.position.x, moon.position.y, z);
                    break;
                case 5:
                    above_cam.position.set(mars.position.x, mars.position.y, z);
                    break;
            }
        }

        function update_focus(val) {
            focus = parseInt(val);
        }

    </script>
    <div id="dragable">
        <h4 style="color: white" id="dragableheader">drücken und halten um zu bewegen</h3>
            <h5 style="color: white; margin-top: 0px;">
                C = Kamera wechseln<br />
                P = Pause<br />
                w/s = Zoomen<br />
                +/- = schnelle/langsamer<br /><br />
                aktuelle Geschwindikeit: <a id="speed">1</a><br />
                Abstand: <a id="distance">50</a> AE <br />
                Planetengröße + <a id="size">0</a> AE<br />
                <input type="range" min="0" max="75" value="0" id="planet_size"> <br />
                Sonnengröße + <a id="size_s">0</a> AE<br />
                <input type="range" min="0" max="25" value="0" id="sun_size"> <br />
                Mondorbit + <a id="orbit_m">0</a> AE<br />
                <input type="range" min="0" max="10" value="0" id="orbit_moon"> <br />
                Planetennamen verstecken: <input type="checkbox" id="check_names" onclick="toggleNames()"><br />
                Fokus auf <select id="fokus">
                    <option value="0" selected>Sonne</option>
                    <option value="1">Merkur</option>
                    <option value="2">Venus</option>
                    <option value="3">Erde</option>
                    <option value="4">Mond</option>
                    <option value="5">Mars</option>
                </select>
            </h5>
    </div>
    <style>
        #dragableheader {
            padding: 10px;
            cursor: move;
            z-index: 10;
            background-color: rgba(200, 200, 200, 0.25);
        }

        #dragable {
            position: absolute;
            z-index: 9;
            background-color: rgba(100, 100, 100, 0.25);
            border: 1px solid #333333;
            text-align: center;
        }

    </style>
    <script>
        dragElement(document.getElementById("dragable"));

        function dragElement(elmnt) {
            var pos1 = 0,
                pos2 = 0,
                pos3 = 0,
                pos4 = 0;
            if (document.getElementById(elmnt.id + "header")) {
                // if present, the header is where you move the DIV from:
                document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
            } else {
                // otherwise, move the DIV from anywhere inside the DIV: 
                elmnt.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

    </script>
    <script>
        var slider_p = document.getElementById("planet_size");
        slider_p.oninput = function() {
            scale(slider_p.value);
            document.getElementById("size").innerHTML = slider_p.value * 1e-1;
        }

        var slider_s = document.getElementById("sun_size");
        slider_s.oninput = function() {
            scale_sun(slider_s.value);
            document.getElementById("size_s").innerHTML = slider_s.value * 1e-3;
        }

        var slider_m = document.getElementById("orbit_moon");
        slider_m.oninput = function() {
            scale_orbit_m(slider_m.value);
            document.getElementById("orbit_m").innerHTML = slider_m.value * 1e-1;
        }

        function toggleNames() {
            var checkBox = document.getElementById("check_names");
            if (checkBox.checked) {
                disable_update();
            } else if (camera == above_cam) {
                enable_update();
            }
        }

        var drop_f = document.getElementById("fokus");
        drop_f.oninput = function() {
            update_focus(drop_f.value);
        }

    </script>
    <br />
    <a href="https://whg-astro-ag.com/das-planetensystem/das-planetensystem-in-digital/">zurück zur Website</a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
</body>

</html>
