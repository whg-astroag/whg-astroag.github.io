<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Das Planetensystem</title>
</head>

<body>
    <h1 style="color: white">Das Planetensystem</h1>

    <script src="js/three.min.js"></script>
    <script src="js/chromeFixes.js"></script>
    <script>
        var scene = new THREE.Scene();

        var aspect_ratio = window.innerWidth / window.innerHeight;
        var above_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6)
        above_cam.position.z = 1000;
        scene.add(above_cam);

        var earth_mars_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6);
        scene.add(earth_mars_cam);

        var earth_moon_cam = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 1e6);
        scene.add(earth_moon_cam);

        var camera = above_cam;

        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth - 50, window.innerHeight - 50);
        document.body.appendChild(renderer.domElement);

        document.body.style.backgroundColor = 'black';

        var surface = new THREE.MeshPhongMaterial({
            ambient: 0xFFD700
        });
        var star = new THREE.SphereGeometry(50, 28, 21);
        var sun = new THREE.Mesh(star, surface);
        scene.add(sun);

        var ambient = new THREE.AmbientLight(0xffffff);
        scene.add(ambient);

        var sunlight = new THREE.PointLight(0xffffff, 5, 1000);
        scene.add(sunlight);

        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0x0000cd
        });
        var planet = new THREE.SphereGeometry(20, 20, 15);
        var earth = new THREE.Mesh(planet, surface);
        earth.position.set(250, 0, 0);
        scene.add(earth);

        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xb22222
        });
        var planet = new THREE.SphereGeometry(20, 20, 15);
        var mars = new THREE.Mesh(planet, surface);
        mars.position.set(500, 0, 0);
        scene.add(mars);

        var surface = new THREE.MeshPhongMaterial({
            ambient: 0x1a1a1a,
            color: 0xffffff
        });
        var planet = new THREE.SphereGeometry(15, 30, 25);
        var moon = new THREE.Mesh(planet, surface);
        var moon_orbit = new THREE.Object3D();
        earth.add(moon_orbit);
        moon_orbit.add(moon);
        moon.position.set(0, 100, 0);
        moon_orbit.add(earth_moon_cam);
        earth_moon_cam.rotation.set(Math.PI / 2, 0, 0);

        var time = 0,
            speed = 1,
            pause = false;

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);

            if (pause) return;
            time += speed;

            var e_angle = time * 0.0008;
            earth.position.set(250 * Math.cos(e_angle), 250 * Math.sin(e_angle), 0);

            var ma_angle = time * 0.0003;
            mars.position.set(500 * Math.cos(ma_angle), 500 * Math.sin(ma_angle), 0);

            var mo_angle = time * 0.02;
            moon_orbit.rotation.set(0, 0, mo_angle);

            var y_diff = mars.position.y - earth.position.y;
            var x_diff = mars.position.x - earth.position.x;
            angle = Math.atan2(x_diff, y_diff);

            earth_mars_cam.rotation.set(Math.PI / 2, -angle, 0);
            earth_mars_cam.position.set(earth.position.x, earth.position.y, 0);
        }

        animate();

        var stars = new THREE.Geometry();
        while (stars.vertices.length < 1e4) {
            var lat = Math.PI * Math.random() - Math.PI / 2;
            var lon = 2 * Math.PI * Math.random();

            stars.vertices.push(new THREE.Vector3(
                1e5 * Math.cos(lon) * Math.cos(lat),
                1e5 * Math.sin(lon) * Math.cos(lat),
                1e5 * Math.sin(lat)
            ));
        }
        var star_stuff = new THREE.ParticleBasicMaterial({
            size: 500
        });
        var star_system = new THREE.ParticleSystem(stars, star_stuff);
        scene.add(star_system);

        document.addEventListener("keydown", function(event) {
            var code = event.keyCode;
            switch (code) {
                case 67: //c
                    changeCamera();
                    break;
                case 80: //P
                    pause = !pause;
                    break;
                case 107: //+
                    speed++;
                    break;
                case 109: //-
                    if (speed > 1) speed--;
                    break;
            }
        });

        function changeCamera() {
            if (camera == above_cam) camera = earth_mars_cam;
            else if (camera == earth_mars_cam) camera = earth_moon_cam;
            else camera = above_cam;
        }

    </script>

    <h3 style="color: white; margin-bottom: 0px;">Steuerung:</h3> <br />
    <h5 style="color: white; margin-top: 0px;">
        C = Kamera wechseln<br />
        P = Pause<br />
        + = schneller<br />
        - = langsamer <br />
    </h5>
</body>

</html>
